/*! uiCropper v1.0.10 License: MIT */angular.module("uiCropper",[]),angular.module("uiCropper").factory("cropAreaCircle",["cropArea",function(t){var e=function(){t.apply(this,arguments),this._boxResizeBaseSize=25,this._boxResizeNormalRatio=1,this._boxResizeHoverRatio=1.2,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._boxResizeNormalSize=this._boxResizeBaseSize*this._boxResizeNormalRatio,this._boxResizeHoverSize=this._boxResizeBaseSize*this._boxResizeHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize=0,this._boxResizeIsHover=!1,this._areaIsHover=!1,this._boxResizeIsDragging=!1,this._areaIsDragging=!1};return(e.prototype=new t).getType=function(){return"circle"},e.prototype._calcCirclePerimeterCoords=function(e){var t=this._size.w/2,i=e*(Math.PI/180);return[this.getCenterPoint().x+t*Math.cos(i),this.getCenterPoint().y+t*Math.sin(i)]},e.prototype._calcResizeIconCenterCoords=function(){return this._calcCirclePerimeterCoords(-45)},e.prototype._isCoordWithinArea=function(e){return Math.sqrt((e[0]-this.getCenterPoint().x)*(e[0]-this.getCenterPoint().x)+(e[1]-this.getCenterPoint().y)*(e[1]-this.getCenterPoint().y))<this._size.w/2},e.prototype._isCoordWithinBoxResize=function(e){var t=this._calcResizeIconCenterCoords(),i=this._boxResizeHoverSize/2;return e[0]>t[0]-i&&e[0]<t[0]+i&&e[1]>t[1]-i&&e[1]<t[1]+i},e.prototype._drawArea=function(e,t,i){e.arc(t.x,t.y,i.w/2,0,2*Math.PI)},e.prototype.draw=function(){t.prototype.draw.apply(this,arguments);var e=this.getCenterPoint();this._cropCanvas.drawIconMove([e.x,e.y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio),this._cropCanvas.drawIconResizeBoxNESW(this._calcResizeIconCenterCoords(),this._boxResizeBaseSize,this._boxResizeIsHover?this._boxResizeHoverRatio:this._boxResizeNormalRatio)},e.prototype.setSizeByScale=function(e){var t=this.getCenterPoint(),i=this.getSize().w*e/2,r={x:t.x-i,y:t.y-i},a={x:t.x+i,y:t.y+i};this.circleOnMove(r,a),this._events.trigger("area-resize")},e.prototype.processMouseMove=function(e,t){var i="default",r=!1;if(this._boxResizeIsHover=!1,this._areaIsHover=!1,this._areaIsDragging)this.setCenterPointOnMove({x:e-this._posDragStartX,y:t-this._posDragStartY}),i="move",r=this._areaIsHover=!0,this._events.trigger("area-move");else if(this._boxResizeIsDragging){var a,s,o;i="nesw-resize",s=e-this._posResizeStartX,a=(o=this._posResizeStartY-t)<s?this._posResizeStartSize.w+2*o:this._posResizeStartSize.w+2*s;var n={},h={};n.x=this.getCenterPoint().x-.5*a,h.x=this.getCenterPoint().x+.5*a,n.y=this.getCenterPoint().y-.5*a,h.y=this.getCenterPoint().y+.5*a,this.circleOnMove(n,h),r=this._boxResizeIsHover=!0,this._events.trigger("area-resize")}else this._isCoordWithinBoxResize([e,t])?(i="nesw-resize",this._areaIsHover=!1,r=this._boxResizeIsHover=!0):this._isCoordWithinArea([e,t])&&(i="move",r=this._areaIsHover=!0);return angular.element(this._ctx.canvas).css({cursor:i}),r},e.prototype.processMouseDown=function(e,t){if(this._isCoordWithinBoxResize([e,t]))this._areaIsDragging=!1,this._areaIsHover=!1,this._boxResizeIsDragging=!0,this._boxResizeIsHover=!0,this._posResizeStartX=e,this._posResizeStartY=t,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start");else if(this._isCoordWithinArea([e,t])){this._areaIsDragging=!0,this._areaIsHover=!0,this._boxResizeIsDragging=!1,this._boxResizeIsHover=!1;var i=this.getCenterPoint();this._posDragStartX=e-i.x,this._posDragStartY=t-i.y,this._events.trigger("area-move-start")}},e.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),this._boxResizeIsDragging&&(this._boxResizeIsDragging=!1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._boxResizeIsHover=!1,this._posDragStartX=0,this._posDragStartY=0},e}]),angular.module("uiCropper").factory("cropAreaRectangle",["cropArea",function(s){var e=function(){s.apply(this,arguments),this._resizeCtrlBaseRadius=15,this._resizeCtrlNormalRatio=.6,this._resizeCtrlHoverRatio=.7,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._resizeCtrlNormalRadius=this._resizeCtrlBaseRadius*this._resizeCtrlNormalRatio,this._resizeCtrlHoverRadius=this._resizeCtrlBaseRadius*this._resizeCtrlHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize={w:0,h:0},this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._resizeCtrlIsDragging=-1,this._areaIsDragging=!1};return(e.prototype=new s).getType=function(){return"rectangle"},e.prototype._calcRectangleCorners=function(){var e=this.getSize(),t=this.getSouthEastBound();return[[e.x,e.y],[t.x,e.y],[e.x,t.y],[t.x,t.y]]},e.prototype._calcRectangleDimensions=function(){var e=this.getSize(),t=this.getSouthEastBound();return{left:e.x,top:e.y,right:t.x,bottom:t.y}},e.prototype._isCoordWithinArea=function(e){var t=this._calcRectangleDimensions();return e[0]>=t.left&&e[0]<=t.right&&e[1]>=t.top&&e[1]<=t.bottom},e.prototype._isCoordWithinResizeCtrl=function(e){for(var t=this._calcRectangleCorners(),i=-1,r=0,a=t.length;r<a;r++){var s=t[r];if(e[0]>s[0]-this._resizeCtrlHoverRadius&&e[0]<s[0]+this._resizeCtrlHoverRadius&&e[1]>s[1]-this._resizeCtrlHoverRadius&&e[1]<s[1]+this._resizeCtrlHoverRadius){i=r;break}}return i},e.prototype._drawArea=function(e,t,i){e.rect(i.x,i.y,i.w,i.h)},e.prototype.draw=function(){s.prototype.draw.apply(this,arguments);var e=this.getCenterPoint();this._cropCanvas.drawIconMove([e.x,e.y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);for(var t=this._calcRectangleCorners(),i=0,r=t.length;i<r;i++){var a=t[i];this._cropCanvas.drawIconResizeBoxBase(a,this._resizeCtrlBaseRadius,this._resizeCtrlIsHover===i?this._resizeCtrlHoverRatio:this._resizeCtrlNormalRatio)}},e.prototype.setSizeByScale=function(e,t){var i,r,a=this.getCenterPoint(),s=this.getSize();if(this._aspect){var o=s.w*e,n=s.h*e;i={x:a.x-o/2,y:a.y-n/2},r={x:a.x+o/2,y:a.y+n/2}}else switch(i={x:s.x,y:s.y},r={x:s.x+s.w,y:s.y+s.h},t){case"up":case"down":r.y=s.y+s.h*e;break;case"left":case"right":r.x=s.x+s.w*e}this.setSizeByCorners(i,r),this._events.trigger("area-resize")},e.prototype.processMouseMove=function(e,t){var i="default",r=!1;if(this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._areaIsDragging)this.setCenterPointOnMove({x:e-this._posDragStartX,y:t-this._posDragStartY}),i="move",r=this._areaIsHover=!0,this._events.trigger("area-move");else if(-1<this._resizeCtrlIsDragging){var a=this.getSize(),s=this.getSouthEastBound(),o=e;switch(this._resizeCtrlIsDragging){case 0:this._aspect&&(o=s.x-(s.y-t)*this._aspect),this.setSizeByCorners({x:o,y:t},{x:s.x,y:s.y}),i="nwse-resize";break;case 1:this._aspect&&(o=a.x+(s.y-t)*this._aspect),this.setSizeByCorners({x:a.x,y:t},{x:o,y:s.y}),i="nesw-resize";break;case 2:this._aspect&&(o=s.x-(t-a.y)*this._aspect),this.setSizeByCorners({x:o,y:a.y},{x:s.x,y:t}),i="nesw-resize";break;case 3:this._aspect&&(o=a.x+(t-a.y)*this._aspect),this.setSizeByCorners({x:a.x,y:a.y},{x:o,y:t}),i="nwse-resize"}this._resizeCtrlIsHover=this._resizeCtrlIsDragging,r=!0,this._events.trigger("area-resize")}else{var n=this._isCoordWithinResizeCtrl([e,t]);if(-1<n){switch(n){case 0:i="nwse-resize";break;case 1:case 2:i="nesw-resize";break;case 3:i="nwse-resize"}this._areaIsHover=!1,this._resizeCtrlIsHover=n,r=!0}else this._isCoordWithinArea([e,t])&&(i="move",r=this._areaIsHover=!0)}return angular.element(this._ctx.canvas).css({cursor:i}),r},e.prototype.processMouseDown=function(e,t){var i=this._isCoordWithinResizeCtrl([e,t]);if(-1<i)this._areaIsDragging=!1,this._areaIsHover=!1,this._resizeCtrlIsDragging=i,this._resizeCtrlIsHover=i,this._posResizeStartX=e,this._posResizeStartY=t,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start");else if(this._isCoordWithinArea([e,t])){this._areaIsDragging=!0,this._areaIsHover=!0,this._resizeCtrlIsDragging=-1,this._resizeCtrlIsHover=-1;var r=this.getCenterPoint();this._posDragStartX=e-r.x,this._posDragStartY=t-r.y,this._events.trigger("area-move-start")}},e.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),-1<this._resizeCtrlIsDragging&&(this._resizeCtrlIsDragging=-1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._resizeCtrlIsHover=-1,this._posDragStartX=0,this._posDragStartY=0},e}]),angular.module("uiCropper").factory("cropAreaSquare",["cropArea",function(s){var e=function(){s.apply(this,arguments),this._resizeCtrlBaseRadius=15,this._resizeCtrlNormalRatio=.6,this._resizeCtrlHoverRatio=.7,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._resizeCtrlNormalRadius=this._resizeCtrlBaseRadius*this._resizeCtrlNormalRatio,this._resizeCtrlHoverRadius=this._resizeCtrlBaseRadius*this._resizeCtrlHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize=0,this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._resizeCtrlIsDragging=-1,this._areaIsDragging=!1};return(e.prototype=new s).getType=function(){return"square"},e.prototype._calcSquareCorners=function(){var e=this.getSize(),t=this.getSouthEastBound();return[[e.x,e.y],[t.x,e.y],[e.x,t.y],[t.x,t.y]]},e.prototype._calcSquareDimensions=function(){var e=this.getSize(),t=this.getSouthEastBound();return{left:e.x,top:e.y,right:t.x,bottom:t.y}},e.prototype._isCoordWithinArea=function(e){var t=this._calcSquareDimensions();return e[0]>=t.left&&e[0]<=t.right&&e[1]>=t.top&&e[1]<=t.bottom},e.prototype._isCoordWithinResizeCtrl=function(e){for(var t=this._calcSquareCorners(),i=-1,r=0,a=t.length;r<a;r++){var s=t[r];if(e[0]>s[0]-this._resizeCtrlHoverRadius&&e[0]<s[0]+this._resizeCtrlHoverRadius&&e[1]>s[1]-this._resizeCtrlHoverRadius&&e[1]<s[1]+this._resizeCtrlHoverRadius){i=r;break}}return i},e.prototype._drawArea=function(e,t,i){e.rect(i.x,i.y,i.w,i.h)},e.prototype.draw=function(){s.prototype.draw.apply(this,arguments);var e=this.getCenterPoint();this._cropCanvas.drawIconMove([e.x,e.y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);for(var t=this._calcSquareCorners(),i=0,r=t.length;i<r;i++){var a=t[i];this._cropCanvas.drawIconResizeBoxBase(a,this._resizeCtrlBaseRadius,this._resizeCtrlIsHover===i?this._resizeCtrlHoverRatio:this._resizeCtrlNormalRatio)}},e.prototype._clampPoint=function(e,t){var i=this._ctx.canvas.width;return e<0&&(t-=Math.abs(e),e=0),t<0&&(e-=Math.abs(t),t=0),i<e&&(t-=i-e,e=i),i<t&&(e-=i-t,t=i),{x:e,y:t}},e.prototype.setSizeByScale=function(e){var t=this.getCenterPoint(),i=this.getSize().w*e;i<this._minSize.w&&(i=this._minSize.w);var r={x:t.x-i/2,y:t.y-i/2},a={x:t.x+i/2,y:t.y+i/2};this.setSizeByCorners(r,a),this._events.trigger("area-resize")},e.prototype.processMouseMove=function(e,t){var i="default",r=!1;if(this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._areaIsDragging)this.setCenterPointOnMove({x:e-this._posDragStartX,y:t-this._posDragStartY}),i="move",r=this._areaIsHover=!0,this._events.trigger("area-move");else if(-1<this._resizeCtrlIsDragging){var a,s;switch(this._resizeCtrlIsDragging){case 0:s=a=-1,i="nwse-resize";break;case 1:s=-(a=1),i="nesw-resize";break;case 2:a=-1,s=1,i="nesw-resize";break;case 3:s=a=1,i="nwse-resize"}var o,n=(e-this._posResizeStartX)*a,h=(t-this._posResizeStartY)*s;o=h<n?this._posResizeStartSize.w+h:this._posResizeStartSize.w+n;var c=Math.max(this._minSize.w,o),l={},u={},g={},p={},f=this.getSize(),d=this.getSouthEastBound();switch(this._resizeCtrlIsDragging){case 0:l.x=d.x-c,l.y=d.y-c,l=this._clampPoint(l.x,l.y),this.setSizeByCorners(l,{x:d.x,y:d.y}),i="nwse-resize";break;case 1:p.x=f.x+c,p.y=d.y-c,p=this._clampPoint(p.x,p.y),this.setSizeByCorners({x:f.x,y:p.y},{x:p.x,y:d.y}),i="nesw-resize";break;case 2:g.x=d.x-c,g.y=f.y+c,g=this._clampPoint(g.x,g.y),this.setSizeByCorners({x:g.x,y:f.y},{x:d.x,y:g.y}),i="nesw-resize";break;case 3:u.x=f.x+c,u.y=f.y+c,u=this._clampPoint(u.x,u.y),this.setSizeByCorners({x:f.x,y:f.y},u),i="nwse-resize"}this._resizeCtrlIsHover=this._resizeCtrlIsDragging,r=!0,this._events.trigger("area-resize")}else{var v=this._isCoordWithinResizeCtrl([e,t]);if(-1<v){switch(v){case 0:i="nwse-resize";break;case 1:case 2:i="nesw-resize";break;case 3:i="nwse-resize"}this._areaIsHover=!1,this._resizeCtrlIsHover=v,r=!0}else this._isCoordWithinArea([e,t])&&(i="move",r=this._areaIsHover=!0)}return angular.element(this._ctx.canvas).css({cursor:i}),r},e.prototype.processMouseDown=function(e,t){var i=this._isCoordWithinResizeCtrl([e,t]);if(-1<i)this._areaIsDragging=!1,this._areaIsHover=!1,this._resizeCtrlIsDragging=i,this._resizeCtrlIsHover=i,this._posResizeStartX=e,this._posResizeStartY=t,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start");else if(this._isCoordWithinArea([e,t])){this._areaIsDragging=!0,this._areaIsHover=!0,this._resizeCtrlIsDragging=-1,this._resizeCtrlIsHover=-1;var r=this.getCenterPoint();this._posDragStartX=e-r.x,this._posDragStartY=t-r.y,this._events.trigger("area-move-start")}},e.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),-1<this._resizeCtrlIsDragging&&(this._resizeCtrlIsDragging=-1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._resizeCtrlIsHover=-1,this._posDragStartX=0,this._posDragStartY=0},e}]),angular.module("uiCropper").factory("cropArea",["cropCanvas",function(r){var e=function(e,t,i){this._ctx=e,this._events=t,this._minSize={x:0,y:0,w:80,h:80},this._initSize=void 0,this._initCoords=void 0,this._allowCropResizeOnCorners=!1,this._forceAspectRatio=!1,this._aspect=null,this._disableCrop=!1,this.transparentColor=i||"",this._cropCanvas=new r(e,this._disableCrop),this._image=new Image,this._size={x:0,y:0,w:150,h:150}};return e.prototype.setAllowCropResizeOnCorners=function(e){this._allowCropResizeOnCorners=e},e.prototype.getImage=function(){return this._image},e.prototype.setImage=function(e){this._image=e},e.prototype.setForceAspectRatio=function(e){this._forceAspectRatio=e},e.prototype.setAspect=function(e){this._aspect=e},e.prototype.getAspect=function(){return this._aspect},e.prototype.getCanvasSize=function(){return{w:this._ctx.canvas.width,h:this._ctx.canvas.height}},e.prototype.getSize=function(){return this._size},e.prototype.setSize=function(e){e=this._processSize(e),this._size=this._preventBoundaryCollision(e)},e.prototype.setSizeOnMove=function(e){e=this._processSize(e),this._allowCropResizeOnCorners?this._size=this._preventBoundaryCollision(e):this._size=this._allowMouseOutsideCanvas(e)},e.prototype.circleOnMove=function(e,t){var i={x:e.x,y:e.y,w:t.x-e.x,h:t.y-e.y},r=this._ctx.canvas.height,a=this._ctx.canvas.width;(i.w>a||i.h>r)&&(a<r?(i.w=a,i.h=a):(i.w=r,i.h=r)),i.x+i.w>a&&(i.x=a-i.w),i.y+i.h>r&&(i.y=r-i.h),i.x<0&&(i.x=0),i.y<0&&(i.y=0),this._minSize.w>i.w&&(i.w=this._minSize.w,i.x=this._size.x),this._minSize.h>i.h&&(i.h=this._minSize.h,i.y=this._size.y),this._size=i},e.prototype.setSizeByCorners=function(e,t){var i={x:e.x,y:e.y,w:t.x-e.x,h:t.y-e.y};this.setSize(i)},e.prototype.getSouthEastBound=function(){return this._southEastBound(this.getSize())},e.prototype.setMinSize=function(e){this._minSize=this._processSize(e),this.setSize(this._minSize)},e.prototype.getMinSize=function(){return this._minSize},e.prototype.getCenterPoint=function(){var e=this.getSize();return{x:e.x+e.w/2,y:e.y+e.h/2}},e.prototype.setCenterPoint=function(e){var t=this.getSize();this.setSize({x:e.x-t.w/2,y:e.y-t.h/2,w:t.w,h:t.h})},e.prototype.setCenterPointOnMove=function(e){var t=this.getSize();this.setSizeOnMove({x:e.x-t.w/2,y:e.y-t.h/2,w:t.w,h:t.h})},e.prototype.setInitSize=function(e){this._initSize=this._processSize(e),this.setSize(this._initSize)},e.prototype.getInitSize=function(){return this._initSize},e.prototype.setInitCoords=function(e){e.h=this.getSize().h,e.w=this.getSize().w,this._initCoords=this._processSize(e),this.setSize(this._initCoords)},e.prototype.setDisableCrop=function(e){this._disableCrop=e,this._cropCanvas=new r(this._ctx,this._disableCrop)},e.prototype.setTransparentColor=function(e){this.transparentColor=e},e.prototype.getInitCoords=function(){return this._initCoords},e.prototype.getType=function(){return"circle"},e.prototype._allowMouseOutsideCanvas=function(e){var t=this._ctx.canvas.height,i=this._ctx.canvas.width,r={w:e.w,h:e.h};return e.x<0?r.x=0:e.x+e.w>i?r.x=i-e.w:r.x=e.x,e.y<0?r.y=0:e.y+e.h>t?r.y=t-e.h:r.y=e.y,r},e.prototype._preventBoundaryCollision=function(e){var t=this._ctx.canvas.height,i=this._ctx.canvas.width,r={x:e.x,y:e.y},a=this._southEastBound(e);r.x<0&&(r.x=0),r.y<0&&(r.y=0),a.x>i&&(a.x=i),a.y>t&&(a.y=t);var s=this._forceAspectRatio?e.w:a.x-r.x,o=this._forceAspectRatio?e.h:a.y-r.y;t<o&&(o=t),this._aspect&&(s=o*this._aspect,r.x+s>i&&(o=(s=i-r.x)/this._aspect,this._minSize.w>s&&(s=this._minSize.w),this._minSize.h>o&&(o=this._minSize.h),r.x=i-s),r.y+o>t&&(r.y=t-o)),this._forceAspectRatio&&(s=o,r.x+s>i&&((s=i-r.x)<this._minSize.w&&(s=this._minSize.w),o=s));var n={x:r.x,y:r.y,w:s,h:o};return n.w<this._minSize.w&&!this._forceAspectRatio&&(n.w=this._minSize.w,(a=this._southEastBound(n)).x>i&&(a.x=i,r.x=Math.max(a.x-i,a.x-this._minSize.w),n={x:r.x,y:r.y,w:a.x-r.x,h:a.y-r.y})),n.h<this._minSize.h&&!this._forceAspectRatio&&(n.h=this._minSize.h,(a=this._southEastBound(n)).y>t&&(a.y=t,r.y=Math.max(a.y-t,a.y-this._minSize.h),n={x:r.x,y:r.y,w:a.x-r.x,h:a.y-r.y})),this._forceAspectRatio&&((a=this._southEastBound(n)).y>t&&(n.y=t-n.h),a.x>i&&(n.x=i-n.w)),n},e.prototype._dontDragOutside=function(){var e=this._ctx.canvas.height,t=this._ctx.canvas.width;this._width>t&&(this._width=t),this._height>e&&(this._height=e),this._x<this._width/2&&(this._x=this._width/2),this._x>t-this._width/2&&(this._x=t-this._width/2),this._y<this._height/2&&(this._y=this._height/2),this._y>e-this._height/2&&(this._y=e-this._height/2)},e.prototype._drawArea=function(){},e.prototype._processSize=function(e){"number"==typeof e&&(e={w:e,h:e});var t=e.w,i=e.h;return this._aspect&&(1<=this.aspect?t=e.h*this._aspect:i=e.w/this._aspect),{x:void 0===e.x?this.getSize().x:e.x,y:void 0===e.y?this.getSize().y:e.y,w:t||this._minSize.w,h:i||this._minSize.h}},e.prototype._southEastBound=function(e){return{x:e.x+e.w,y:e.y+e.h}},e.prototype.draw=function(){this._cropCanvas.drawCropArea(this._image,this.getCenterPoint(),this._size,this._drawArea,this.transparentColor)},e.prototype.processMouseMove=function(){},e.prototype.processMouseDown=function(){},e.prototype.processMouseUp=function(){},e}]),angular.module("uiCropper").factory("cropCanvas",[function(){var a=[[-.5,-2],[-3,-4.5],[-.5,-7],[-7,-7],[-7,-.5],[-4.5,-3],[-2,-.5]],s=[[.5,-2],[3,-4.5],[.5,-7],[7,-7],[7,-.5],[4.5,-3],[2,-.5]],o=[[-.5,2],[-3,4.5],[-.5,7],[-7,7],[-7,.5],[-4.5,3],[-2,.5]],h=[[.5,2],[3,4.5],[.5,7],[7,7],[7,.5],[4.5,3],[2,.5]],i=[[-1.5,-2.5],[-1.5,-6],[-5,-6],[0,-11],[5,-6],[1.5,-6],[1.5,-2.5]],u=[[-2.5,-1.5],[-6,-1.5],[-6,-5],[-11,0],[-6,5],[-6,1.5],[-2.5,1.5]],g=[[-1.5,2.5],[-1.5,6],[-5,6],[0,11],[5,6],[1.5,6],[1.5,2.5]],p=[[2.5,-1.5],[6,-1.5],[6,-5],[11,0],[6,5],[6,1.5],[2.5,1.5]],f="#fff",d="#bababa",v="#444",m="#fff",w="#bababa",y="#444",_="#fff",C=1;return function(c,l){var n=function(e,t,i){return[i*e[0]+t[0],i*e[1]+t[1]]},r=function(e,t,i,r){if(!l){c.save(),c.fillStyle=t,c.beginPath();var a,s=n(e[0],i,r);for(var o in c.moveTo(s[0],s[1]),e)0<o&&(a=n(e[o],i,r),c.lineTo(a[0],a[1]));c.lineTo(s[0],s[1]),c.fill(),c.closePath(),c.restore()}};this.drawIconMove=function(e,t){l||(r(i,_,e,t),r(u,_,e,t),r(g,_,e,t),r(p,_,e,t))},this.drawIconResizeCircle=function(e,t,i){if(!l){var r=t*i;c.save(),c.strokeStyle=w,c.lineWidth=C,c.fillStyle=y,c.beginPath(),c.arc(e[0],e[1],r,0,2*Math.PI),c.fill(),c.stroke(),c.closePath(),c.restore()}},this.drawIconResizeBoxBase=function(e,t,i){if(!l){var r=t*i;c.save(),c.strokeStyle=d,c.lineWidth=C,c.fillStyle=v,c.fillRect(e[0]-r/2,e[1]-r/2,r,r),c.strokeRect(e[0]-r/2,e[1]-r/2,r,r),c.restore()}},this.drawIconResizeBoxNESW=function(e,t,i){l||(this.drawIconResizeBoxBase(e,t,i),r(s,m,e,i),r(o,m,e,i))},this.drawIconResizeBoxNWSE=function(e,t,i){l||(this.drawIconResizeBoxBase(e,t,i),r(a,m,e,i),r(h,m,e,i))},this.drawCropArea=function(e,t,i,r,a){if(!l){var s=Math.abs(e.width/c.canvas.width),o=Math.abs(e.height/c.canvas.height),n=Math.abs(t.x-i.w/2),h=Math.abs(t.y-i.h/2);c.save(),c.strokeStyle=f,c.lineWidth=C,c.setLineDash([5,5]),c.beginPath(),r(c,t,i),c.stroke(),c.clip(),0<i.w&&(c.clearRect(n,h,Math.abs(i.w),Math.abs(i.h)),a&&(c.save(),c.fillStyle=a,c.fillRect(n,h,Math.abs(i.w),Math.abs(i.h)),c.restore()),c.drawImage(e,n*s,h*o,Math.abs(i.w*s),Math.abs(i.h*o),n,h,Math.abs(i.w),Math.abs(i.h))),c.beginPath(),r(c,t,i),c.stroke(),c.clip(),c.restore()}}}}]),angular.module("uiCropper").service("cropEXIF",[function(){var l=!1,c=this.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},u=this.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},g=this.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},p=this.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function a(e){return!!e.exifdata}function i(r,a){function t(e){var t=h(e),i=function(e){var t=new DataView(e);if(l&&console.log("Got file of length "+e.byteLength),255!==t.getUint8(0)||216!==t.getUint8(1))return l&&console.log("Not a valid JPEG"),!1;for(var i,r,a=2,s=e.byteLength;a<s;){if(r=a,56===(i=t).getUint8(r)&&66===i.getUint8(r+1)&&73===i.getUint8(r+2)&&77===i.getUint8(r+3)&&4===i.getUint8(r+4)&&4===i.getUint8(r+5)){var o=t.getUint8(a+7);o%2!=0&&(o+=1),0===o&&(o=4);var n=a+8+o,h=t.getUint16(a+6+o);return d(e,n,h)}a++}}(e);r.exifdata=t||{},r.iptcdata=i||{},a&&a.call(r)}var e,i,s,o=new FileReader;if(r.src){/^data\:/i.test(r.src)?t(function(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var i=atob(e),r=i.length,a=new ArrayBuffer(r),s=new Uint8Array(a),o=0;o<r;o++)s[o]=i.charCodeAt(o);return a}(r.src)):/^blob\:/i.test(r.src)&&(o.onload=function(e){t(e.target.result)},e=r.src,i=function(e){o.readAsArrayBuffer(e)},(s=new XMLHttpRequest).open("GET",e,!0),s.responseType="blob",s.onload=function(e){200!==this.status&&0!==this.status||i(this.response)},s.send());var n=new XMLHttpRequest;n.onload=function(){if(200!==this.status&&0!==this.status)throw"Could not load image";t(n.response),n=null},n.open("GET",r.src,!0),n.responseType="arraybuffer";try{n.send(null)}catch(e){}}else window.FileReader&&(r instanceof window.Blob||r instanceof window.File)&&(o.onload=function(e){l&&console.log("Got file of length "+e.target.result.byteLength),t(e.target.result)},o.readAsArrayBuffer(r))}function h(e){var t=new DataView(e);if(l&&console.log("Got file of length "+e.byteLength),255!==t.getUint8(0)||216!==t.getUint8(1))return l&&console.log("Not a valid JPEG"),!1;for(var i,r=2,a=e.byteLength;r<a;){if(255!==t.getUint8(r))return l&&console.log("Not a valid marker at offset "+r+", found: "+t.getUint8(r)),!1;if(i=t.getUint8(r+1),l&&console.log(i),225===i)return l&&console.log("Found 0xFFE1 marker"),s(t,r+4,t.getUint16(r+2));r+=2+t.getUint16(r+2)}}var f={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function d(e,t,i){for(var r,a,s,o,n=new DataView(e),h={},c=t;c<t+i;)28===n.getUint8(c)&&2===n.getUint8(c+1)&&(o=n.getUint8(c+2))in f&&(s=n.getInt16(c+3),a=f[o],r=w(n,c+5,s),h.hasOwnProperty(a)?h[a]instanceof Array?h[a].push(r):h[a]=[h[a],r]:h[a]=r),c++;return h}function v(e,t,i,r,a){var s,o,n,h=e.getUint16(i,!a),c={};for(n=0;n<h;n++)s=i+12*n+2,!(o=r[e.getUint16(s,!a)])&&l&&console.log("Unknown tag: "+e.getUint16(s,!a)),c[o]=m(e,s,t,0,a);return c}function m(e,t,i,r,a){var s,o,n,h,c,l,u=e.getUint16(t+2,!a),g=e.getUint32(t+4,!a),p=e.getUint32(t+8,!a)+i;switch(u){case 1:case 7:if(1===g)return e.getUint8(t+8,!a);for(s=4<g?p:t+8,o=[],h=0;h<g;h++)o[h]=e.getUint8(s+h);return o;case 2:return w(e,s=4<g?p:t+8,g-1);case 3:if(1===g)return e.getUint16(t+8,!a);for(s=2<g?p:t+8,o=[],h=0;h<g;h++)o[h]=e.getUint16(s+2*h,!a);return o;case 4:if(1===g)return e.getUint32(t+8,!a);for(o=[],h=0;h<g;h++)o[h]=e.getUint32(p+4*h,!a);return o;case 5:if(1===g)return c=e.getUint32(p,!a),l=e.getUint32(p+4,!a),(n={}).numerator=c,n.denominator=l,n;for(o=[],h=0;h<g;h++)c=e.getUint32(p+8*h,!a),l=e.getUint32(p+4+8*h,!a),o[h]={},o[h].numerator=c,o[h].denominator=l;return o;case 9:if(1===g)return e.getInt32(t+8,!a);for(o=[],h=0;h<g;h++)o[h]=e.getInt32(p+4*h,!a);return o;case 10:if(1===g)return e.getInt32(p,!a)/e.getInt32(p+4,!a);for(o=[],h=0;h<g;h++)o[h]=e.getInt32(p+8*h,!a)/e.getInt32(p+4+8*h,!a);return o}}function w(e,t,i){for(var r="",a=t;a<t+i;a++)r+=String.fromCharCode(e.getUint8(a));return r}function s(e,t){if("Exif"!==w(e,t,4))return l&&console.log("Not valid EXIF data! "+w(e,t,4)),!1;var i,r,a,s,o,n=t+6;if(18761===e.getUint16(n))i=!1;else{if(19789!==e.getUint16(n))return l&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;i=!0}if(42!==e.getUint16(n+2,!i))return l&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var h=e.getUint32(n+4,!i);if(h<8)return l&&console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(n+4,!i)),!1;if((r=v(e,n,n+h,u,i)).ExifIFDPointer)for(a in s=v(e,n,n+r.ExifIFDPointer,c,i)){switch(a){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":s[a]=p[a][s[a]];break;case"ExifVersion":case"FlashpixVersion":s[a]=String.fromCharCode(s[a][0],s[a][1],s[a][2],s[a][3]);break;case"ComponentsConfiguration":s[a]=p.Components[s[a][0]]+p.Components[s[a][1]]+p.Components[s[a][2]]+p.Components[s[a][3]]}r[a]=s[a]}if(r.GPSInfoIFDPointer)for(a in o=v(e,n,n+r.GPSInfoIFDPointer,g,i)){switch(a){case"GPSVersionID":o[a]=o[a][0]+"."+o[a][1]+"."+o[a][2]+"."+o[a][3]}r[a]=o[a]}return r}this.getData=function(e,t){return!((e instanceof Image||e instanceof HTMLImageElement)&&!e.complete||(a(e)?t&&t.call(e):i(e,t),0))},this.getTag=function(e,t){if(a(e))return e.exifdata[t]},this.getAllTags=function(e){if(!a(e))return{};var t,i=e.exifdata,r={};for(t in i)i.hasOwnProperty(t)&&(r[t]=i[t]);return r},this.pretty=function(e){if(!a(e))return"";var t,i=e.exifdata,r="";for(t in i)i.hasOwnProperty(t)&&("object"==typeof i[t]?i[t]instanceof Number?r+=t+" : "+i[t]+" ["+i[t].numerator+"/"+i[t].denominator+"]\r\n":r+=t+" : ["+i[t].length+" values]\r\n":r+=t+" : "+i[t]+"\r\n");return r},this.readFromBinaryFile=function(e){return h(e)}}]),angular.module("uiCropper").factory("cropHost",["$document","$q","cropAreaCircle","cropAreaSquare","cropAreaRectangle","cropEXIF",function(A,B,H,U,F,L){var N=8,T=function(e){var t=e.getBoundingClientRect(),i=document.body,r=document.documentElement,a=window.pageYOffset||r.scrollTop||i.scrollTop,s=window.pageXOffset||r.scrollLeft||i.scrollLeft,o=r.clientTop||i.clientTop||0,n=r.clientLeft||i.clientLeft||0,h=t.top+a-o,c=t.left+s-n;return{top:Math.round(h),left:Math.round(c)}};return function(p,a,f){var d=null,v=null,m=null,l=null,u=null,g=this,w=[100,100],y=[300,300],_=null,i=[],r={w:200,h:200},s=null,C="image/png",o=null,n={up:38,down:40,left:37,right:39},z=!1;function S(e){m.transparentColor&&(e.save(),e.fillStyle=m.transparentColor,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore())}function x(){d.clearRect(0,0,d.canvas.width,d.canvas.height),null!==v&&(S(d),d.drawImage(v,0,0,d.canvas.width,d.canvas.height),m._disableCrop||(d.save(),d.fillStyle="rgba(0, 0, 0, 0.65)",d.fillRect(0,0,d.canvas.width,d.canvas.height),d.restore()),m.draw())}this.setInitMax=function(e){l=e},this.setAllowCropResizeOnCorners=function(e){m.setAllowCropResizeOnCorners(e)},this.setDisableCrop=function(e){m.setDisableCrop(e),x()},this.setTransparentColor=function(e){var t,i;m.setTransparentColor((t=e,(i=document.createElement("div").style).color=t,i.color)),x()};var I=function(){p[0].focus()};function b(e,t){var i=e/t,r=[e,t],a={left:0,top:0};return r[0]>y[0]?(r[0]=y[0],r[1]=r[0]/i,a.top=(y[1]-r[1])/2):(r[1]>y[1]?(r[1]=y[1],r[0]=r[1]*i):a.top=(y[1]-r[1])/2,a.left=(y[0]-r[0])/2),{dims:r,margins:a}}var R=function(){var e=[0,0];if(null!==v){if(I(),m.setImage(v),"fit"===_){var t=b(v.width,v.height);e=t.dims;var i=t.margins;p.css({"margin-left":i.left+"px","margin-top":i.top+"px"})}else{var r=[v.width,v.height],a=v.width/v.height;(e=r)[0]>y[0]?(e[0]=y[0],e[1]=e[0]/a):e[0]<w[0]&&(e[0]=w[0],e[1]=e[0]/a),"fixed-height"===_&&e[1]>y[1]?(e[1]=y[1],e[0]=e[1]*a):e[1]<w[1]&&(e[1]=w[1],e[0]=e[1]*a)}p.prop("width",e[0]).prop("height",e[1]),"fixed-height"===_&&p.css({"margin-left":-e[0]/2+"px","margin-top":-e[1]/2+"px"});var s=d.canvas.width,o=d.canvas.height,n=g.getAreaType();if("circle"===n||"square"===n)o<s&&(s=o),o=s;else if("rectangle"===n&&u){var h=m.getAspect();h<s/o?s=h*o:o=h*s}if(l?m.setSize({w:s,h:o}):void 0!==m.getInitSize()?m.setSize({w:Math.min(m.getInitSize().w,s/2),h:Math.min(m.getInitSize().h,o/2)}):m.setSize({w:Math.min(200,s/2),h:Math.min(200,o/2)}),m.getInitCoords())if(g.areaInitIsRelativeToImage){var c=v.width/e[0];m.setSize({w:m.getInitSize().w/c,h:m.getInitSize().h/c,x:m.getInitCoords().x/c,y:m.getInitCoords().y/c})}else m.setSize({w:m.getSize().w,h:m.getSize().h,x:m.getInitCoords().x,y:m.getInitCoords().y});else m.setCenterPoint({x:d.canvas.width/2,y:d.canvas.height/2})}else p.prop("width",0).prop("height",0).css({"margin-top":0});x()},h=function(e){return angular.isDefined(e.changedTouches)?e.changedTouches:e.originalEvent.changedTouches},e=function(e){if(!m._disableCrop&&null!==v){var t,i,r=T(d.canvas);"touchmove"===e.type?(t=h(e)[0].pageX,i=h(e)[0].pageY):(t=e.pageX,i=e.pageY),m.processMouseMove(t-r.left,i-r.top),x()}},t=function(e){if(e.preventDefault(),!m._disableCrop&&(a.allowPropagation||e.stopPropagation(),null!==v)){I();var t,i,r=T(d.canvas);"touchstart"===e.type?(t=h(e)[0].pageX,i=h(e)[0].pageY):(t=e.pageX,i=e.pageY),m.processMouseDown(t-r.left,i-r.top),x()}},c=function(e){if(!m._disableCrop&&null!==v){var t,i,r=T(d.canvas);"touchend"===e.type?(t=h(e)[0].pageX,i=h(e)[0].pageY):(t=e.pageX,i=e.pageY),m.processMouseUp(t-r.left,i-r.top),x()}},D=function(e){var i;if(!m._disableCrop&&null!==v&&!0!==a.disableKeyboardAccess){var t=e.which;switch(t){case n.up:case n.down:case n.left:case n.right:e.preventDefault(),e.stopPropagation();var r=(i=t,Object.keys(n).reduce(function(e,t){return i===n[t]?t:e},null));e.shiftKey?function(e){if(!m._disableCrop){var t;switch(e){case"up":case"left":t=.95;break;case"down":case"right":t=1.05;break;default:return}m.setSizeByScale(t,e),x()}}(r):function(e){if(!m._disableCrop){var t=m.getCenterPoint(),i={x:t.x,y:t.y};switch(e){case"up":i.y-=5;break;case"down":i.y+=5;break;case"left":i.x-=5;break;case"right":i.x+=5;break;default:return}m.setCenterPointOnMove(i),x()}}(r);break;default:return}}},M=function(e,t){var i,r;if(i=(r=angular.element("<canvas></canvas>")[0]).getContext("2d"),r.width=e.w,r.height=e.h,null!==v){var a=(t.x-m.getSize().w/2)*(v.width/d.canvas.width),s=(t.y-m.getSize().h/2)*(v.height/d.canvas.height),o=m.getSize().w*(v.width/d.canvas.width),n=m.getSize().h*(v.height/d.canvas.height);if(z)S(i),i.drawImage(v,a,s,o,n,0,0,e.w,e.h);else{var h,c,l=o/n;1<l?h=(c=e.w)/l:c=(h=e.h)*l,r.width=c,r.height=h,S(i),i.drawImage(v,a,s,o,n,0,0,Math.round(c),Math.round(h))}}return r},P=function(e){var t,i={dataURI:null,imageData:null};return t=M(e,m.getCenterPoint()),null!==v&&(i.dataURI=null!==o?t.toDataURL(C,o):t.toDataURL(C)),i};this.getResultImage=function(){if(0===i.length)return P(this.getResultImageSize());for(var e=[],t=0;t<i.length;t++)e.push({dataURI:P(i[t]).dataURI,w:i[t].w,h:i[t].h});return e},this.getResultImageDataBlob=function(){var e,t=B.defer();return e=M(this.getResultImageSize(),m.getCenterPoint()),null!==o?e.toBlob(function(e){t.resolve(e)},C,o):e.toBlob(function(e){t.resolve(e)},C),t.promise},this.getAreaCoords=function(){return m.getSize()},this.getArea=function(){return m},this.setNewImageSource=function(e){if(v=null,R(),e){var g=new Image;g.onload=function(){f.trigger("load-done"),L.getData(g,function(){var e=L.getTag(g,"Orientation");if(-1<[3,6,8].indexOf(e)){var t=document.createElement("canvas"),i=t.getContext("2d"),r=g.width,a=g.height,s=0,o=0,n=0,h=0,c=0;switch(h=r,c=a,e){case 3:s=-g.width,o=-g.height,n=180;break;case 6:r=g.height,a=g.width,o=-g.height,h=a,c=r,n=90;break;case 8:r=g.height,a=g.width,s=-g.width,h=a,c=r,n=270}var l=1e3;if(l<r||l<a){var u=0;l<r?(u=l/r,r=l,a*=u):l<a&&(u=l/a,a=l,r*=u),o*=u,s*=u,h*=u,c*=u}t.width=r,t.height=a,i.rotate(n*Math.PI/180),i.drawImage(g,s,o,h,c),(v=new Image).onload=function(){R(),f.trigger("image-updated")},v.src=t.toDataURL(C)}else v=g,f.trigger("image-updated");R()})},g.onerror=function(){f.trigger("load-error")},f.trigger("load-start"),e instanceof window.Blob?g.src=URL.createObjectURL(e):("http"!==e.substring(0,4).toLowerCase()&&"//"!==e.substring(0,2)||(g.crossOrigin="anonymous"),g.src=e)}},this.setMaxDimensions=function(e,t){if(y=[e,t],null!==v){var i=d.canvas.width,r=d.canvas.height,a=[0,0];if("fit"===_){var s=b(v.width,v.height);a=s.dims;var o=s.margins;p.css({"margin-left":o.left+"px","margin-top":o.top+"px"})}else{var n=[v.width,v.height],h=v.width/v.height;(a=n)[0]>y[0]?(a[0]=y[0],a[1]=a[0]/h):a[0]<w[0]&&(a[0]=w[0],a[1]=a[0]/h),"fixed-height"===_&&a[1]>y[1]?(a[1]=y[1],a[0]=a[1]*h):a[1]<w[1]&&(a[1]=w[1],a[0]=a[1]*h)}p.prop("width",a[0]).prop("height",a[1]),"fixed-height"===_&&p.css({"margin-left":-a[0]/2+"px","margin-top":-a[1]/2+"px"});var c=i?d.canvas.width/i:0,l=r?d.canvas.height/r:0,u=Math.min(c,l),g=m.getCenterPoint();m.setSize({w:m.getSize().w*u,h:m.getSize().h*u}),m.setCenterPoint({x:g.x*c,y:g.y*l})}else p.prop("width",0).prop("height",0).css({"margin-top":0});x()},this.setAreaMinSize=function(e){angular.isUndefined(e)||(e="number"==typeof e||"string"==typeof e?{w:parseInt(parseInt(e),10),h:parseInt(parseInt(e),10)}:{w:parseInt(e.w,10),h:parseInt(e.h,10)},isNaN(e.w)||isNaN(e.h)||(m.setMinSize(e),x()))},this.setAreaMinRelativeSize=function(e){if(null!==v&&!angular.isUndefined(e)){var t=m.getCanvasSize();"number"==typeof e||"string"==typeof e?(s={w:e,h:e},e={w:t.w/(v.width/parseInt(parseInt(e),10)),h:t.h/(v.height/parseInt(parseInt(e),10))}):(s=e,e={w:t.w/(v.width/parseInt(parseInt(e.w),10)),h:t.h/(v.height/parseInt(parseInt(e.h),10))}),isNaN(e.w)||isNaN(e.h)||(m.setMinSize(e),x())}},this.setAreaInitSize=function(e){angular.isUndefined(e)||(e="number"==typeof e||"string"==typeof e?{w:parseInt(parseInt(e),10),h:parseInt(parseInt(e),10)}:{w:parseInt(e.w,10),h:parseInt(e.h,10)},isNaN(e.w)||isNaN(e.h)||(m.setInitSize(e),x()))},this.setAreaInitCoords=function(e){angular.isUndefined(e)||(e={x:parseInt(e.x,10),y:parseInt(e.y,10)},isNaN(e.x)||isNaN(e.y)||(m.setInitCoords(e),x()))},this.setMaxCanvasDimensions=function(e){if(!angular.isUndefined(e)){var t=[];t="number"==typeof e||"string"==typeof e?[parseInt(parseInt(e),10),parseInt(parseInt(e),10)]:[parseInt(e.w,10),parseInt(e.h,10)],!isNaN(t[0])&&0<t[0]&&t[0]>w[0]&&!isNaN(t[1])&&0<t[1]&&t[1]>w[1]&&(y=t)}},this.setMinCanvasDimensions=function(e){if(!angular.isUndefined(e)){var t=[];t="number"==typeof e||"string"==typeof e?[parseInt(parseInt(e),10),parseInt(parseInt(e),10)]:[parseInt(e.w,10),parseInt(e.h,10)],!isNaN(t[0])&&0<=t[0]&&!isNaN(t[1])&&0<=t[1]&&(w=t)}},this.setScalemode=function(e){_=e},this.getScalemode=function(){return _},this.getResultImageSize=function(){if("selection"===r)return m.getSize();if("max"===r){var e=1;v&&d&&d.canvas&&(e=v.width/d.canvas.width);var t={w:e*m.getSize().w,h:e*m.getSize().h};return s&&(t.w<s.w&&(t.w=s.w),t.h<s.h&&(t.h=s.h)),t}return r},this.setResultImageSize=function(e){if(angular.isArray(e))return i=e.slice(),void(e={w:parseInt(e[0].w,10),h:parseInt(e[0].h,10)});angular.isUndefined(e)||(angular.isString(e)?r=e:(angular.isNumber(e)&&(e={w:e=parseInt(e,10),h:e}),e={w:parseInt(e.w,10),h:parseInt(e.h,10)},isNaN(e.w)||isNaN(e.h)||(r=e,x())))},this.setResultImageFormat=function(e){C=e},this.setResultImageQuality=function(e){e=parseFloat(e),!isNaN(e)&&0<=e&&e<=1&&(o=e)},this.getAreaType=function(){return m.getType()},this.setAreaType=function(e){var t=m.getCenterPoint(),i=m.getSize(),r=m.getMinSize(),a=t.x,s=t.y,o=H;"square"===e?o=U:"rectangle"===e&&(o=F),(m=new o(d,f,m&&m.transparentColor)).setMinSize(r),m.setSize(i),"square"===e||"circle"===e?(z=!0,m.setForceAspectRatio(!0)):(z=!1,m.setForceAspectRatio(!1)),m.setCenterPoint({x:a,y:s}),null!==v&&m.setImage(v),x()},this.getDominantColor=function(e){var t=new Image,i=new ColorThief,r=null,a=B.defer();return t.src=e,t.onload=function(){r=i.getColor(t),a.resolve(r)},a.promise},this.getPalette=function(e){var t=new Image,i=new ColorThief,r=null,a=B.defer();return t.src=e,t.onload=function(){r=i.getPalette(t,N),a.resolve(r)},a.promise},this.setPaletteColorLength=function(e){N=e},this.setAspect=function(e){u=!0,m.setAspect(e);var t=m.getMinSize();t.w=t.h*e,m.setMinSize(t);var i=m.getSize();i.w=i.h*e,m.setSize(i)},d=p[0].getContext("2d"),m=new H(d,f),A.on("mousemove",e),p.on("mousedown",t),A.on("mouseup",c),A.on("touchmove",e),p.on("touchstart",t),A.on("touchend",c),p.prop("tabindex","0"),p.on("keydown",D),this.destroy=function(){A.off("mousemove",e),p.off("mousedown",t),A.off("mouseup",c),A.off("touchmove",e),p.off("touchstart",t),A.off("touchend",c),p.off("keydown",D),p.remove()}}}]),angular.module("uiCropper").factory("cropPubSub",[function(){return function(){var i={};this.on=function(e,t){return e.split(" ").forEach(function(e){i[e]||(i[e]=[]),i[e].push(t)}),this},this.trigger=function(e,t){return angular.forEach(i[e],function(e){e.call(null,t)}),this}}}]),angular.module("uiCropper").directive("uiCropper",["$timeout","cropHost","cropPubSub",function(h,c,t){return{restrict:"E",scope:{image:"=",resultImage:"=",resultArrayImage:"=?",resultBlob:"=?",urlBlob:"=?",chargement:"=?",cropject:"=?",maxCanvasDimensions:"=?",minCanvasDimensions:"=?",canvasScalemode:"@?",changeOnFly:"=?",disableKeyboardAccess:"=?",allowPropagation:"=?",liveView:"=?",initMaxArea:"=?",areaCoords:"=?",areaType:"@",areaMinSize:"=?",areaInitSize:"=?",areaInitCoords:"=?",areaInitIsRelativeToImage:"=?",areaMinRelativeSize:"=?",resultImageSize:"=?",resultImageFormat:"@",resultImageQuality:"=?",aspectRatio:"=?",allowCropResizeOnCorners:"=?",transparentColor:"@",dominantColor:"=?",paletteColor:"=?",paletteColorLength:"=?",disableCrop:"=?",onChange:"&",onLoadBegin:"&",onLoadDone:"&",onLoadError:"&"},template:"<canvas></canvas>",controller:["$scope",function(e){e.events=new t}],link:function(i,r){var o,e=i.events,n=new c(r.find("canvas"),{disableKeyboardAccess:i.disableKeyboardAccess,allowPropagation:i.allowPropagation},e);i.canvasScalemode?n.setScalemode(i.canvasScalemode):n.setScalemode("fixed-height"),r.addClass(n.getScalemode());var t=function(t,e,i){if(""!==t.image&&(!t.liveView.block||e)){var r,a=n.getResultImage();angular.isArray(a)?(r=a[0].dataURI,t.resultArrayImage=a):r=a.dataURI;var s=window.URL||window.webkitURL;o!==r&&(o=r,t.resultImage=r,t.liveView.callback&&t.liveView.callback(r),i&&i(r),n.getResultImageDataBlob().then(function(e){t.resultBlob=e,t.urlBlob=e?s.createObjectURL(e):null}),t.resultImage&&(n.getDominantColor(t.resultImage).then(function(e){t.dominantColor=e}),n.getPalette(t.resultImage).then(function(e){t.paletteColor=e})),t.areaCoords=n.getAreaCoords(),t.onChange({$dataURI:t.resultImage}))}};i.liveView&&"boolean"==typeof i.liveView.block?i.liveView.render=function(e){t(i,!0,e)}:i.liveView={block:!1};var a=function(e){var t=n.getAreaCoords(),i=n.getArea().getImage().width/n.getArea().getCanvasSize().w,r=n.getArea().getImage().height/n.getArea().getCanvasSize().h;e.cropject={canvasSize:n.getArea().getCanvasSize(),areaCoords:t,cropWidth:t.w,cropHeight:t.h,cropTop:t.y,cropLeft:t.x,cropImageWidth:Math.round(t.w*i),cropImageHeight:Math.round(t.h*r),cropImageTop:Math.round(t.y*r),cropImageLeft:Math.round(t.x*i)}},s=function(t){return function(){h(function(){i.$apply(function(e){t(e)})})}};i.chargement||(i.chargement=function(){switch(window.navigator.userLanguage||window.navigator.language){case"nl":case"nl_NL":return"Aan het laden";case"fr":case"fr-FR":return"Chargement";case"es":case"es-ES":return"Cargando";case"ca":case"ca-ES":return"Càrrega";case"de":case"de-DE":return"Laden";case"pt":case"pt-BR":return"Carregando";default:return"Loading"}}()),e.on("load-start",s(function(e){e.onLoadBegin({})})).on("load-done",s(function(e){var t=r.children();angular.forEach(t,function(e){angular.element(e).hasClass("loading")&&angular.element(e).remove()}),a(e),e.onLoadDone({})})).on("load-error",s(function(e){e.onLoadError({})})).on("area-move area-resize",s(function(e){!0===e.changeOnFly&&t(e),a(e)})).on("image-updated",s(function(e){n.setAreaMinRelativeSize(e.areaMinRelativeSize)})).on("area-move-end area-resize-end image-updated",s(function(e){t(e),a(e)})),i.$watch("image",function(e){n.getArea()&&(n.getArea()._size={x:0,y:0,w:0,h:0}),e&&r.append('<div class="loading"><span>'+i.chargement+"...</span></div>"),null!==i.timeout&&h.cancel(i.timeout),i.timeout=h(function(){i.timeout=null,n.setInitMax(i.initMaxArea),n.setNewImageSource(i.image)},100)}),i.$watch("areaType",function(){n.setAreaType(i.areaType),t(i)}),i.$watch("areaMinSize",function(){n.setAreaMinSize(i.areaMinSize),t(i)}),i.$watch("areaMinRelativeSize",function(){""!==i.image&&(n.setAreaMinRelativeSize(i.areaMinRelativeSize),t(i))}),i.$watch("areaInitSize",function(){n.setAreaInitSize(i.areaInitSize),t(i)}),i.$watch("areaInitCoords",function(){n.setAreaInitCoords(i.areaInitCoords),n.areaInitIsRelativeToImage=i.areaInitIsRelativeToImage,t(i)}),i.$watch("maxCanvasDimensions",function(){n.setMaxCanvasDimensions(i.maxCanvasDimensions)}),i.$watch("minCanvasDimensions",function(){n.setMinCanvasDimensions(i.minCanvasDimensions)}),i.$watch("resultImageFormat",function(){n.setResultImageFormat(i.resultImageFormat),n.setTransparentColor("image/jpeg"===i.resultImageFormat?i.transparentColor:""),t(i)}),i.$watch("resultImageQuality",function(){n.setResultImageQuality(i.resultImageQuality),t(i)}),i.$watch("resultImageSize",function(){n.setResultImageSize(i.resultImageSize),t(i)}),i.$watch("paletteColorLength",function(){n.setPaletteColorLength(i.paletteColorLength)}),i.$watch("aspectRatio",function(){"string"==typeof i.aspectRatio&&""!==i.aspectRatio&&(i.aspectRatio=parseFloat(i.aspectRatio)),i.aspectRatio&&n.setAspect(i.aspectRatio)}),i.$watch("allowCropResizeOnCorners",function(){i.allowCropResizeOnCorners&&n.setAllowCropResizeOnCorners(i.allowCropResizeOnCorners)}),i.$watch("disableCrop",function(){n.setDisableCrop(i.disableCrop)}),i.$watch("transparentColor",function(){n.setTransparentColor(i.transparentColor),t(i)}),i.$watch(function(){return"fit"===n.getScalemode()?[r[0].clientWidth,r[0].clientHeight]:"fixed-height"===n.getScalemode()?[r[0].clientWidth,r[0].clientHeight]:"full-width"===n.getScalemode()?r[0].clientWidth:void 0},function(e){"fit"===n.getScalemode()&&(n.setMaxDimensions(e[0],e[1]),t(i)),"fixed-height"===n.getScalemode()&&0<e[0]&&0<e[1]&&(n.setMaxDimensions(e[0],e[1]),t(i)),"full-width"===n.getScalemode()&&0<e&&n.setMaxDimensions(e)},!0),i.$on("$destroy",function(){n.destroy()})}}}]),function(e){"use strict";var l,u=e.Uint8Array,t=e.HTMLCanvasElement,i=t&&t.prototype,h=/\s*;\s*base64\s*(?:;|$)/i,c="toDataURL";u&&(l=new u([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),t&&!i.toBlob&&(i.toBlob=function(e,t){if(t||(t="image/png"),this.mozGetAsFile)e(this.mozGetAsFile("canvas",t));else if(this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(t))e(this.msToBlob());else{var i,r=Array.prototype.slice.call(arguments,1),a=this[c].apply(this,r),s=a.indexOf(","),o=a.substring(s+1),n=h.test(a.substring(0,s));Blob.fake?((i=new Blob).encoding=n?"base64":"URI",i.data=o,i.size=o.length):u&&(i=n?new Blob([function(e){for(var t,i,r=e.length,a=new u(r/4*3|0),s=0,o=0,n=[0,0],h=0,c=0;r--;)i=e.charCodeAt(s++),255!==(t=l[i-43])&&void 0!==t&&(n[1]=n[0],n[0]=i,c=c<<6|t,4==++h&&(a[o++]=c>>>16,61!==n[1]&&(a[o++]=c>>>8),61!==n[0]&&(a[o++]=c),h=0));return a}(o)],{type:t}):new Blob([decodeURIComponent(o)],{type:t})),void 0!==e&&e(i)}},i.toDataURLHD?i.toBlobHD=function(){c="toDataURLHD";var e=this.toBlob();return c="toDataURL",e}:i.toBlobHD=i.toBlob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),function(){var f=function(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=e.width,this.height=this.canvas.height=e.height,this.context.drawImage(e,0,0,this.width,this.height)};f.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},f.prototype.update=function(e){this.context.putImageData(e,0,0)},f.prototype.getPixelCount=function(){return this.width*this.height},f.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},f.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var e=function(){};if((window.ColorThief=e).prototype.getColor=function(e,t){return this.getPalette(e,5,t)[0]},e.prototype.getPalette=function(e,t,i){void 0===t&&(t=10),(void 0===i||i<1)&&(i=10);for(var r,a,s,o,n=new f(e),h=n.getImageData().data,c=n.getPixelCount(),l=[],u=0;u<c;u+=i)a=h[(r=4*u)+0],s=h[r+1],o=h[r+2],125<=h[r+3]&&(250<a&&250<s&&250<o||l.push([a,s,o]));var g=d.quantize(l,t),p=g?g.palette():null;return n.removeCanvas(),p},!H)var H={map:function(e,i){var r={};return i?e.map(function(e,t){return r.index=t,i.call(r,e)}):e.slice()},naturalOrder:function(e,t){return e<t?-1:t<e?1:0},sum:function(e,r){var a={};return e.reduce(r?function(e,t,i){return a.index=i,e+r.call(a,t)}:function(e,t){return e+t},0)},max:function(e,t){return Math.max.apply(null,t?H.map(e,t):e)}};var d=function(){var x=5,I=8-x,b=1e3,R=.75;function D(e,t,i){return(e<<2*x)+(t<<x)+i}function M(e){var t=[],i=!1;function r(){t.sort(e),i=!0}return{push:function(e){t.push(e),i=!1},peek:function(e){return i||r(),void 0===e&&(e=t.length-1),t[e]},pop:function(){return i||r(),t.pop()},size:function(){return t.length},map:function(e){return t.map(e)},debug:function(){return i||r(),t}}}function P(e,t,i,r,a,s,o){var n=this;n.r1=e,n.r2=t,n.g1=i,n.g2=r,n.b1=a,n.b2=s,n.histo=o}function A(){this.vboxes=new M(function(e,t){return H.naturalOrder(e.vbox.count()*e.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function B(e,c){if(c.count()){var t=c.r2-c.r1+1,i=c.g2-c.g1+1,r=c.b2-c.b1+1,a=H.max([t,i,r]);if(1==c.count())return[c.copy()];var l,s,o,n,u=0,g=[],p=[];if(a==t)for(l=c.r1;l<=c.r2;l++){for(n=0,s=c.g1;s<=c.g2;s++)for(o=c.b1;o<=c.b2;o++)n+=e[D(l,s,o)]||0;u+=n,g[l]=u}else if(a==i)for(l=c.g1;l<=c.g2;l++){for(n=0,s=c.r1;s<=c.r2;s++)for(o=c.b1;o<=c.b2;o++)n+=e[D(s,l,o)]||0;u+=n,g[l]=u}else for(l=c.b1;l<=c.b2;l++){for(n=0,s=c.r1;s<=c.r2;s++)for(o=c.g1;o<=c.g2;o++)n+=e[D(s,o,l)]||0;u+=n,g[l]=u}return g.forEach(function(e,t){p[t]=u-e}),h(a==t?"r":a==i?"g":"b")}function h(e){var t,i,r,a,s,o=e+"1",n=e+"2",h=0;for(l=c[o];l<=c[n];l++)if(g[l]>u/2){for(r=c.copy(),a=c.copy(),s=(t=l-c[o])<=(i=c[n]-l)?Math.min(c[n]-1,~~(l+i/2)):Math.max(c[o],~~(l-1-t/2));!g[s];)s++;for(h=p[s];!h&&g[s-1];)h=p[--s];return r[n]=s,a[o]=r[n]+1,[r,a]}}}return P.prototype={volume:function(e){var t=this;return t._volume&&!e||(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(e){var t=this,i=t.histo;if(!t._count_set||e){var r,a,s,o=0;for(r=t.r1;r<=t.r2;r++)for(a=t.g1;a<=t.g2;a++)for(s=t.b1;s<=t.b2;s++){o+=i[D(r,a,s)]||0}t._count=o,t._count_set=!0}return t._count},copy:function(){var e=this;return new P(e.r1,e.r2,e.g1,e.g2,e.b1,e.b2,e.histo)},avg:function(e){var t=this,i=t.histo;if(!t._avg||e){var r,a,s,o,n=0,h=1<<8-x,c=0,l=0,u=0;for(a=t.r1;a<=t.r2;a++)for(s=t.g1;s<=t.g2;s++)for(o=t.b1;o<=t.b2;o++)n+=r=i[D(a,s,o)]||0,c+=r*(a+.5)*h,l+=r*(s+.5)*h,u+=r*(o+.5)*h;t._avg=n?[~~(c/n),~~(l/n),~~(u/n)]:[~~(h*(t.r1+t.r2+1)/2),~~(h*(t.g1+t.g2+1)/2),~~(h*(t.b1+t.b2+1)/2)]}return t._avg},contains:function(e){var t=this,i=e[0]>>I;return gval=e[1]>>I,bval=e[2]>>I,i>=t.r1&&i<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},A.prototype={push:function(e){this.vboxes.push({vbox:e,color:e.avg()})},palette:function(){return this.vboxes.map(function(e){return e.color})},size:function(){return this.vboxes.size()},map:function(e){for(var t=this.vboxes,i=0;i<t.size();i++)if(t.peek(i).vbox.contains(e))return t.peek(i).color;return this.nearest(e)},nearest:function(e){for(var t,i,r,a=this.vboxes,s=0;s<a.size();s++)((i=Math.sqrt(Math.pow(e[0]-a.peek(s).color[0],2)+Math.pow(e[1]-a.peek(s).color[1],2)+Math.pow(e[2]-a.peek(s).color[2],2)))<t||void 0===t)&&(t=i,r=a.peek(s).color);return r},forcebw:function(){var e=this.vboxes;e.sort(function(e,t){return H.naturalOrder(H.sum(e.color),H.sum(t.color))});var t=e[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(e[0].color=[0,0,0]);var i=e.length-1,r=e[i].color;251<r[0]&&251<r[1]&&251<r[2]&&(e[i].color=[255,255,255])}},{quantize:function(e,t){if(!e.length||t<2||256<t)return!1;var i,r,a,s,o,n,h=(i=e,n=new Array(1<<3*x),i.forEach(function(e){a=e[0]>>I,s=e[1]>>I,o=e[2]>>I,r=D(a,s,o),n[r]=(n[r]||0)+1}),n);h.forEach(function(){});var c,l,u,g,p,f,d,v,m,w,y=(c=h,m=d=p=1e6,w=v=f=0,e.forEach(function(e){l=e[0]>>I,u=e[1]>>I,g=e[2]>>I,l<p?p=l:f<l&&(f=l),u<d?d=u:v<u&&(v=u),g<m?m=g:w<g&&(w=g)}),new P(p,f,d,v,m,w,c)),_=new M(function(e,t){return H.naturalOrder(e.count(),t.count())});function C(e,t){for(var i,r=1,a=0;a<b;)if((i=e.pop()).count()){var s=B(h,i),o=s[0],n=s[1];if(!o)return;if(e.push(o),n&&(e.push(n),r++),t<=r)return;if(a++>b)return}else e.push(i),a++}_.push(y),C(_,R*t);for(var z=new M(function(e,t){return H.naturalOrder(e.count()*e.volume(),t.count()*t.volume())});_.size();)z.push(_.pop());C(z,t-z.size());for(var S=new A;z.size();)S.push(z.pop());return S}}}();"function"==typeof define&&define.amd?define([],function(){return e}):"object"==typeof exports?module.exports=e:this.ColorThief=e}.call(this),function(){function w(e,t,i,r){var a=e.naturalWidth,s=e.naturalHeight;if(a+s!==!1){var o=i.width,n=i.height,h=t.getContext("2d");h.save(),function(e,t,i,r,a){switch(a){case 5:case 6:case 7:case 8:e.width=r,e.height=i;break;default:e.width=i,e.height=r}switch(a){case 2:t.translate(i,0),t.scale(-1,1);break;case 3:t.translate(i,r),t.rotate(Math.PI);break;case 4:t.translate(0,r),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-r);break;case 7:t.rotate(.5*Math.PI),t.translate(i,-r),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-i,0)}}(t,h,o,n,i.orientation),function(e){var t=e.naturalWidth;if(1048576<t*e.naturalHeight){var i=document.createElement("canvas");i.width=i.height=1;var r=i.getContext("2d");return r.drawImage(e,1-t,0),0===r.getImageData(0,0,1,1).data[3]}return!1}(e)&&(a/=2,s/=2);var c=1024,l=document.createElement("canvas");l.width=l.height=c;for(var u=l.getContext("2d"),g=r?function(e,t,i){var r=document.createElement("canvas");r.width=1,r.height=i;var a=r.getContext("2d");a.drawImage(e,0,0);for(var s=a.getImageData(0,0,1,i).data,o=0,n=i,h=i;o<h;)0===s[4*(h-1)+3]?n=h:o=h,h=n+o>>1;var c=h/i;return 0===c?1:c}(e,0,s):1,p=Math.ceil(c*o/a),f=Math.ceil(c*n/s/g),d=0,v=0;d<s;){for(var m=0,w=0;m<a;)u.clearRect(0,0,c,c),u.drawImage(e,-m,-d),h.drawImage(l,0,0,c,c,w,v,p,f),m+=c,w+=p;d+=c,v+=f}h.restore(),l=u=null}}var y=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;function e(e){if(window.Blob&&e instanceof Blob){if(!y)throw Error("No createObjectURL function found to create blob url");var t=new Image;t.src=y.createObjectURL(e),this.blob=e,e=t}if(!e.naturalWidth&&!e.naturalHeight){var r=this;e.onload=e.onerror=function(){var e=r.imageLoadListeners;if(e){r.imageLoadListeners=null;for(var t=0,i=e.length;t<i;t++)e[t]()}},this.imageLoadListeners=[]}this.srcImage=e}e.prototype.render=function(e,t,i){if(this.imageLoadListeners){var r=this;this.imageLoadListeners.push(function(){r.render(e,t,i)})}else{t=t||{};var a=this.srcImage.naturalWidth,s=this.srcImage.naturalHeight,o=t.width,n=t.height,h=t.maxWidth,c=t.maxHeight,l=!this.blob||"image/jpeg"===this.blob.type;o&&!n?n=s*o/a<<0:n&&!o?o=a*n/s<<0:(o=a,n=s),h&&h<o&&(n=s*(o=h)/a<<0),c&&c<n&&(o=a*(n=c)/s<<0);var u={width:o,height:n};for(var g in t)u[g]=t[g];var p,f,d,v,m=e.tagName.toLowerCase();"img"===m?e.src=(p=this.srcImage,f=u,d=l,v=document.createElement("canvas"),w(p,v,f,d),v.toDataURL("image/jpeg",f.quality||.8)):"canvas"===m&&w(this.srcImage,e,u,l),"function"==typeof this.onrender&&this.onrender(e),i&&i(),this.blob&&(this.blob=null,y.revokeObjectURL(this.srcImage.src))}},"function"==typeof define&&define.amd?define([],function(){return e}):"object"==typeof exports?module.exports=e:this.MegaPixImage=e}.call(this);